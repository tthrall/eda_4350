<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.5.57">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">

<meta name="author" content="Send comments to: Tony T (adthral)">
<meta name="dcterms.date" content="2025-01-12">

<title>Sampling and Study Design</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
</style>


<script src="s_3a_4350_files/libs/clipboard/clipboard.min.js"></script>
<script src="s_3a_4350_files/libs/quarto-html/quarto.js"></script>
<script src="s_3a_4350_files/libs/quarto-html/popper.min.js"></script>
<script src="s_3a_4350_files/libs/quarto-html/tippy.umd.min.js"></script>
<script src="s_3a_4350_files/libs/quarto-html/anchor.min.js"></script>
<link href="s_3a_4350_files/libs/quarto-html/tippy.css" rel="stylesheet">
<link href="s_3a_4350_files/libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="s_3a_4350_files/libs/bootstrap/bootstrap.min.js"></script>
<link href="s_3a_4350_files/libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="s_3a_4350_files/libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">

  <script src="https://cdnjs.cloudflare.com/polyfill/v3/polyfill.min.js?features=es6"></script>
  <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml-full.js" type="text/javascript"></script>

<script type="text/javascript">
const typesetMath = (el) => {
  if (window.MathJax) {
    // MathJax Typeset
    window.MathJax.typeset([el]);
  } else if (window.katex) {
    // KaTeX Render
    var mathElements = el.getElementsByClassName("math");
    var macros = [];
    for (var i = 0; i < mathElements.length; i++) {
      var texText = mathElements[i].firstChild;
      if (mathElements[i].tagName == "SPAN") {
        window.katex.render(texText.data, mathElements[i], {
          displayMode: mathElements[i].classList.contains('display'),
          throwOnError: false,
          macros: macros,
          fleqn: false
        });
      }
    }
  }
}
window.Quarto = {
  typesetMath
};
</script>

</head>

<body class="fullcontent">

<div id="quarto-content" class="page-columns page-rows-contents page-layout-article">

<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title">Sampling and Study Design</h1>
<p class="subtitle lead">Part 1, session 3a of Data Mining Intro</p>
</div>



<div class="quarto-title-meta">

    <div>
    <div class="quarto-title-meta-heading">Author</div>
    <div class="quarto-title-meta-contents">
             <p>Send comments to: Tony T (adthral) </p>
          </div>
  </div>
    
    <div>
    <div class="quarto-title-meta-heading">Published</div>
    <div class="quarto-title-meta-contents">
      <p class="date">January 12, 2025</p>
    </div>
  </div>
  
    
  </div>
  
<div>
  <div class="abstract">
    <div class="block-title">Abstract</div>
    Introduce basic ideas and methods in statistical sampling theory and the design of experimental or observational studies.
  </div>
</div>


</header>


<hr>
<section id="introduction" class="level2">
<h2 class="anchored" data-anchor-id="introduction">Introduction</h2>
<p>This session introduces some basic ideas and methods in statistical sampling theory and the design of experimental or observational studies. We follow the book “Statistics, 4/e” by Freedman, Pisani, and Purves (<a href="https://www.goodreads.com/book/show/147358.Statistics">FPP</a>).</p>
<p>As our world becomes evermore connected digitally, the available data of interest may seem either to encompass the entire population of interest (e.g., online behavior of consumers), or else to be highly focused (e.g., the purchasing history of a particular customer). At these extremes the notion of a sample from a population might seem irrelevant. But sampling theory becomes relevant as soon as we transition from describing the data on hand to asking how current phenomena might change under various scenarios.</p>
<p>We begin with examples of observational and experimental studies, and review some sampling strategies under practical constraints.</p>
</section>
<section id="observational-study-examples" class="level2">
<h2 class="anchored" data-anchor-id="observational-study-examples">Observational Study Examples</h2>
<section id="literary-digest-poll-1936" class="level3">
<h3 class="anchored" data-anchor-id="literary-digest-poll-1936">Literary Digest Poll, 1936</h3>
<p>In 1936, President Franklin Delano Roosevelt (FDR) was completing his first term in office, and running for re-election against Alfred Landon, Governor of Kansas state. Most pundits predicted that FDR would win.</p>
<p>The <em>Literary Digest</em> magazine, however, predicted a decisive Landon victory based on a massive poll having 2.4 million respondents. The <em>Digest</em> predicted that Roosevelt would get only 43% of the vote.</p>
<p>George Gallup had just created his polling organization. Gallup took a sample of 3,000 voters to estimate what the <em>Digest</em> would predict, and took a sample of 50,000 voters to predict the election. Here are the results.</p>
<div class="cell">
<div class="cell-output-display">
<table class="caption-top table table-sm table-striped small">
<caption>Predicted % for FDR in 1936</caption>
<thead>
<tr class="header">
<th style="text-align: left;">source</th>
<th style="text-align: right;">FDR predicted %</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">Digest</td>
<td style="text-align: right;">43</td>
</tr>
<tr class="even">
<td style="text-align: left;">Gallup re Digest</td>
<td style="text-align: right;">44</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Gallup re election</td>
<td style="text-align: right;">56</td>
</tr>
<tr class="even">
<td style="text-align: left;">election result</td>
<td style="text-align: right;">62</td>
</tr>
</tbody>
</table>
</div>
</div>
<p>As it turned out, Roosevelt won by a landslide: 62% versus 38%. The <em>Digest’s</em> error of nearly 20 percentage points is the largest in history by a major poll. What went wrong?</p>
<p>Moral: a large sample size alone does not guarantee accuracy. Ask yourself how the sample was chosen.</p>
</section>
<section id="truman-versus-dewey-1948" class="level3">
<h3 class="anchored" data-anchor-id="truman-versus-dewey-1948">Truman versus Dewey, 1948</h3>
<p>Truman was a colorful and effective US president, but he was the underdog in the 1948 elelction. Three major polling organizations covered the election: Crossley for the Hearst newspapers, Gallup (synicated in ~100 newspapers across the country), and Roper for <em>Fortune</em> magazine. By the fall of 1948, all three put Dewey ahead of Truman by 5 or more percentage points. Here are the predicted and actual percentages.</p>
<div class="cell">
<div class="cell-output-display">
<table class="caption-top table table-sm table-striped small">
<caption>Predicted % per candidate in 1948</caption>
<thead>
<tr class="header">
<th style="text-align: left;">source</th>
<th style="text-align: right;">Truman</th>
<th style="text-align: right;">Dewey</th>
<th style="text-align: right;">Thrumond</th>
<th style="text-align: right;">Wallace</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">Crossley</td>
<td style="text-align: right;">45</td>
<td style="text-align: right;">50</td>
<td style="text-align: right;">2</td>
<td style="text-align: right;">3</td>
</tr>
<tr class="even">
<td style="text-align: left;">Gallup</td>
<td style="text-align: right;">44</td>
<td style="text-align: right;">50</td>
<td style="text-align: right;">2</td>
<td style="text-align: right;">4</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Roper</td>
<td style="text-align: right;">38</td>
<td style="text-align: right;">53</td>
<td style="text-align: right;">5</td>
<td style="text-align: right;">4</td>
</tr>
<tr class="even">
<td style="text-align: left;">election result</td>
<td style="text-align: right;">50</td>
<td style="text-align: right;">45</td>
<td style="text-align: right;">3</td>
<td style="text-align: right;">2</td>
</tr>
</tbody>
</table>
</div>
</div>
<p>All three polling organizations not only under-estimated the percentage vote for Truman, they were also over-confident in their predictions. Again we ask, what went wrong?</p>
<p>The three polling organizations used <em>quota sampling</em>. That is, in an effort to construct samples representative of all voters, the polling organizations ensured that sample percentages of women, men, employed, unemployed, and so on, exactly matched known population percentages.</p>
<p>Interviewers were given prescribed numbers of voters to interview in each category, and were otherwise unconstrained in their choice of subjects to interview.</p>
<p>The problem is that there are many factors that influence voting, and many of them cannot be known in advance of the election. In addition, allowing the interviewers to select their subjects (constrained only by certain demographic quotas to be fulfilled) may introduce an unwitting bias, namely toward those whom the interviewers find easier to include. As it happened, quota sampling produced a bias toward those subjects who voted Republican.<a href="#fn1" class="footnote-ref" id="fnref1" role="doc-noteref"><sup>1</sup></a></p>
</section>
<section id="using-chance-in-surveys" class="level3">
<h3 class="anchored" data-anchor-id="using-chance-in-surveys">Using Chance in Surveys</h3>
<p>Since 1948 polling organizations have adopted some form of <em>probability sampling</em>. The idea is that there are too many known and unknown factors that influence voting to control for them all. Therefore it is better to choose subjects at random, allowing chance to provide a sample that approximately represents the population (with better approximation for larger sample sizes).</p>
<p>The leading example of probability sampling is <em>simple random sampling</em>. Imagine a box of tickets, one ticket per registered voter. We shuffle the tickets, randomly select one to include in our sample, set that ticket aside, and then repeat this process.</p>
<p>When little is known about a population, simple random sampling yields more accurate estimates of a population percentage or population average than other probability samples of the same size.<a href="#fn2" class="footnote-ref" id="fnref2" role="doc-noteref"><sup>2</sup></a> The problem is that simple random sampling is impractical in many situations. Even if polling organizations had a list (sampling frame) of all registered voters in the country, it would be prohibitively costly to interview subjects scattered across the country.</p>
<p>Instead, polling organizations often use <em>multi-stage cluster sampling</em>. As an example, from 1952 to 1984 the Gallup organization partitioned the 50 states into four regions: Northeast, South, Midwest, and West. In each region, towns are selected at random; within each town, wards are selected at random; within each ward, precincts are selected at random; and fnally within each precinct, households are selected at random. Then the eligible voters present in the household (cluster) are interviewed.<a href="#fn3" class="footnote-ref" id="fnref3" role="doc-noteref"><sup>3</sup></a> At each stage, random selection may be weighted, e.g., by population size.</p>
<p>Probability sampling of any type has two important features:</p>
<ul>
<li>interviewers have no discretion in the choice of subjects;</li>
<li>there is a prescribed procedure for selecting subjects, involving the planned use of chance.</li>
</ul>
<p>The hallmark of a probability sample is that the chance of including any given individual in the sample can be calculated in advance.</p>
</section>
<section id="more-recent-election-polls" class="level3">
<h3 class="anchored" data-anchor-id="more-recent-election-polls">More Recent Election Polls</h3>
<p>Since the 1952 election Gallup and other pollsters have used probability samples, and have, on the whole, reduced the magnitude of prediction error. Here are the prediction errors of the Gallup organization. (Ross Perot’s candidacy made 1992 an especially challenging year to predict.)</p>
<div class="cell">
<div class="cell-output-display">
<table class="caption-top table table-sm table-striped small">
<caption>Gallup prediction accuracy: 1952-2004</caption>
<thead>
<tr class="header">
<th style="text-align: right;">year</th>
<th style="text-align: right;">n</th>
<th style="text-align: left;">winner</th>
<th style="text-align: right;">Gallup</th>
<th style="text-align: right;">actual</th>
<th style="text-align: right;">error</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: right;">1952</td>
<td style="text-align: right;">5385</td>
<td style="text-align: left;">Eisenhower</td>
<td style="text-align: right;">51.0</td>
<td style="text-align: right;">55.1</td>
<td style="text-align: right;">-4.1</td>
</tr>
<tr class="even">
<td style="text-align: right;">1956</td>
<td style="text-align: right;">8144</td>
<td style="text-align: left;">Eisenhower</td>
<td style="text-align: right;">59.5</td>
<td style="text-align: right;">57.4</td>
<td style="text-align: right;">2.1</td>
</tr>
<tr class="odd">
<td style="text-align: right;">1960</td>
<td style="text-align: right;">8015</td>
<td style="text-align: left;">Kennedy</td>
<td style="text-align: right;">51.0</td>
<td style="text-align: right;">49.7</td>
<td style="text-align: right;">1.3</td>
</tr>
<tr class="even">
<td style="text-align: right;">1964</td>
<td style="text-align: right;">6625</td>
<td style="text-align: left;">Johnson</td>
<td style="text-align: right;">64.0</td>
<td style="text-align: right;">61.1</td>
<td style="text-align: right;">2.9</td>
</tr>
<tr class="odd">
<td style="text-align: right;">1968</td>
<td style="text-align: right;">4414</td>
<td style="text-align: left;">Nixon</td>
<td style="text-align: right;">43.0</td>
<td style="text-align: right;">43.4</td>
<td style="text-align: right;">-0.4</td>
</tr>
<tr class="even">
<td style="text-align: right;">1972</td>
<td style="text-align: right;">3689</td>
<td style="text-align: left;">Nixon</td>
<td style="text-align: right;">62.0</td>
<td style="text-align: right;">60.7</td>
<td style="text-align: right;">1.3</td>
</tr>
<tr class="odd">
<td style="text-align: right;">1976</td>
<td style="text-align: right;">3439</td>
<td style="text-align: left;">Carter</td>
<td style="text-align: right;">48.0</td>
<td style="text-align: right;">50.1</td>
<td style="text-align: right;">-2.1</td>
</tr>
<tr class="even">
<td style="text-align: right;">1980</td>
<td style="text-align: right;">3500</td>
<td style="text-align: left;">Reagan</td>
<td style="text-align: right;">47.0</td>
<td style="text-align: right;">50.7</td>
<td style="text-align: right;">-3.7</td>
</tr>
<tr class="odd">
<td style="text-align: right;">1984</td>
<td style="text-align: right;">3456</td>
<td style="text-align: left;">Reagan</td>
<td style="text-align: right;">59.0</td>
<td style="text-align: right;">58.8</td>
<td style="text-align: right;">0.2</td>
</tr>
<tr class="even">
<td style="text-align: right;">1988</td>
<td style="text-align: right;">4089</td>
<td style="text-align: left;">Bush</td>
<td style="text-align: right;">56.0</td>
<td style="text-align: right;">53.4</td>
<td style="text-align: right;">2.6</td>
</tr>
<tr class="odd">
<td style="text-align: right;">1992</td>
<td style="text-align: right;">2019</td>
<td style="text-align: left;">Clinton</td>
<td style="text-align: right;">49.0</td>
<td style="text-align: right;">43.0</td>
<td style="text-align: right;">6.0</td>
</tr>
<tr class="even">
<td style="text-align: right;">1996</td>
<td style="text-align: right;">2895</td>
<td style="text-align: left;">Clinton</td>
<td style="text-align: right;">52.0</td>
<td style="text-align: right;">49.2</td>
<td style="text-align: right;">2.8</td>
</tr>
<tr class="odd">
<td style="text-align: right;">2000</td>
<td style="text-align: right;">3571</td>
<td style="text-align: left;">Bush</td>
<td style="text-align: right;">48.0</td>
<td style="text-align: right;">47.9</td>
<td style="text-align: right;">0.1</td>
</tr>
<tr class="even">
<td style="text-align: right;">2004</td>
<td style="text-align: right;">2014</td>
<td style="text-align: left;">Bush</td>
<td style="text-align: right;">49.0</td>
<td style="text-align: right;">50.6</td>
<td style="text-align: right;">-1.6</td>
</tr>
</tbody>
</table>
</div>
</div>
</section>
<section id="uc-berkeley-admissions" class="level3">
<h3 class="anchored" data-anchor-id="uc-berkeley-admissions">UC Berkeley Admissions</h3>
<p>In a previous session we discussed a study from the 1970’s arising from a concern that admissions to graduate school at UC Berkeley might be biased against females. The study determined that the apparent bias was an instance of Simpon’s Paradox: females tended to apply to the departments having lower overall admission rates, resulting in an overall lower admission rate for females, even though most of the departments admitted a greater percentage of their female applicants than their male applicants.</p>
<p>In the context of sampling theory, we note that the data were limited to a single year, and included <em>all</em> applicants. One might ask whether the differences in admission rates were “statistically significant”, but the question presumes that the data are the result of a probability sample from a larger population, which is not the case here. The year of data (1973) was accepted as evidence that the apparent bias was an instance of Simpson’s Paradox. The concern was resolved under the assumption that the data and circumstances from that particular year were indicative of the admissions process.</p>
<p>Moral: the expected accuracy of statistical estimates has been established for various types of probability sampling, but if the data are not the result of a probability sample from a defined population, these established formulas are not applicable.</p>
</section>
</section>
<section id="class-exercise" class="level2">
<h2 class="anchored" data-anchor-id="class-exercise">Class Exercise</h2>
<p>Break into teams of two or three to identify examples of (or opportunities for) observational studies in the context of work. Which of these would you regard as most valuable? Based on the examples above, or your experience, what are the potential pitfalls of such studies? Take 15 minutes to prepare to report to the class.</p>
</section>
<section id="experimental-study-examples" class="level2">
<h2 class="anchored" data-anchor-id="experimental-study-examples">Experimental Study Examples</h2>
<section id="salk-vaccine-field-trial" class="level3">
<h3 class="anchored" data-anchor-id="salk-vaccine-field-trial">Salk Vaccine Field Trial</h3>
<p>Polio has been a devastating, sometimes fatal, disease. The first epidemic in the US was in 1916. In the following years the disease claimed several hundreds of thousands of victims, especially children. By the 1950’s several drugs against polio were in development. The drug developed by Jonas Salk had particularly promising lab results. By 1954 the US government determined the drug should be tested in the field.</p>
<p>One might ask why a promising drug shouldn’t simply be adopted, rather than field-tested. One problem was that polio incidence varied considerably from year to year. In 1952 there were about 60,000 cases. The following year there were half that number. Had the vaccine been adopted in 1954, any decrease in incidence could well have been ascribed to annual variation, rather than the effectiveness of the vaccine.</p>
<p>The decision to test rather than adopt a promising drug is a difficult question of medical ethics. For the polio vaccine, there were potential risks in taking the drug, and so the government decided a test was needed to establish whether the benefits of adopting the drug would outweigh the risks.</p>
<p>The National Foundation for Infantile Paralysis (NFIP) ran a controlled experiment among children in grades 1-3, an especially vulnerable age group. The field trial was carried out in selected school districts throughout the country, where the risk of polio was high. AS originally designed, the NFIP vaccinated all children in grade 2 whose parents consented to the vaccination, leaving unvaccinated those children in grade 2 whose parents did not consetn. Children in grades 1 and 3 were used as the controld group (were not vaccinated). The following table shows the results.</p>
<div class="cell">
<div class="cell-output-display">
<table class="caption-top table table-sm table-striped small">
<caption>NFIP: polio rate per 100,000 subjects</caption>
<thead>
<tr class="header">
<th style="text-align: left;">grade</th>
<th style="text-align: left;">assignment</th>
<th style="text-align: right;">size</th>
<th style="text-align: right;">rate</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">2</td>
<td style="text-align: left;">treatment</td>
<td style="text-align: right;">225000</td>
<td style="text-align: right;">25</td>
</tr>
<tr class="even">
<td style="text-align: left;">1, 3</td>
<td style="text-align: left;">control</td>
<td style="text-align: right;">725000</td>
<td style="text-align: right;">54</td>
</tr>
<tr class="odd">
<td style="text-align: left;">2</td>
<td style="text-align: left;">no_consent</td>
<td style="text-align: right;">125000</td>
<td style="text-align: right;">44</td>
</tr>
</tbody>
</table>
</div>
</div>
<p>Participating public health experts raised several concerns with the NFIP design. Polio can be transmitted by touch, so the incidence of polio infection may vary by grade. Also, parental consent is a potential confounding factor. More highly educated parents are more likely to consent, but their children are at greater risk. (Lower socio-economic status is associated with lower hygiene, and thus a greater chance of early exposure to polio when the mother’s antibodies would be activated, enabling the child to fight off a subsequent infection.) Consequently children of non-consenting parents should not be included in the control group, but rather analyzed separately.</p>
<p>Consequently a second experiment was conducted in which both the treatment and control group came from the same population of children whose parents consented to vaccination. Those children would be assigned at random either to the treatment (vaccinated) or control (unvaccinated) group. Moreover, this was to be a “double-blind” experiment: the assignment of each participating child would be closely held among the administrators of the experiment, and not shared with participating parents, medical staff responsible for injections (of either the vaccine or a saline solution), or physicians determining whether a paricipating child had or had not contracted polio. Children whose parents did not consent to vaccination would be tracked separately from others. Here are the results of the double-blind experiment.</p>
<div class="cell">
<div class="cell-output-display">
<table class="caption-top table table-sm table-striped small">
<caption>Double-Blind: polio rate per 100,000 subjects</caption>
<thead>
<tr class="header">
<th style="text-align: left;">assignment</th>
<th style="text-align: right;">size</th>
<th style="text-align: right;">rate</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">treatment</td>
<td style="text-align: right;">200000</td>
<td style="text-align: right;">28</td>
</tr>
<tr class="even">
<td style="text-align: left;">control</td>
<td style="text-align: right;">200000</td>
<td style="text-align: right;">71</td>
</tr>
<tr class="odd">
<td style="text-align: left;">no_consent</td>
<td style="text-align: right;">350000</td>
<td style="text-align: right;">46</td>
</tr>
</tbody>
</table>
</div>
</div>
<p>Both experments provide strong evidence of the effectiveness of the vaccine. In addition, the second experiment bears out the concern that parental consent could be a confounding factor. Among the children of consenting parents who served as controls, and thus were not vaccinated, the polio rate is markedly higher than in the NFIP experiment where controls consisted of children in grades 1 and 3, some of whose parents would not have consented to vaccination had they been asked.</p>
<p>Key points:</p>
<ul>
<li>enlisting experts to identify potential confounding factors is essential to good experimental design;</li>
<li>double-blind experiments are often required to avoid potential unwitting bias in treatment-control assignments or the determination of experimental outcomes.</li>
</ul>
</section>
<section id="portacaval-shunt" class="level3">
<h3 class="anchored" data-anchor-id="portacaval-shunt">Portacaval Shunt</h3>
<p>In some cases of cirrhosis of the liver, the patient may start to hemorrhage and bleed to death. One treatment involves surgery to redirect the flow of blood through a portacaval shunt. The operation to create the shunt is long and hazardous. Do the benefits outweigh the risks? The effectiveness of this surgery has been evaluated in 51 studies, summarized in the following table.</p>
<div class="cell">
<div class="cell-output-display">
<table class="caption-top table table-sm table-striped small">
<caption>Shunt evaluations: degree of enthusiasm per study design</caption>
<thead>
<tr class="header">
<th style="text-align: left;">design</th>
<th style="text-align: right;">marked</th>
<th style="text-align: right;">moderate</th>
<th style="text-align: right;">none</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">No controls</td>
<td style="text-align: right;">24</td>
<td style="text-align: right;">7</td>
<td style="text-align: right;">1</td>
</tr>
<tr class="even">
<td style="text-align: left;">Controls, but not randomized</td>
<td style="text-align: right;">10</td>
<td style="text-align: right;">3</td>
<td style="text-align: right;">2</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Randomized controlled</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">3</td>
</tr>
</tbody>
</table>
</div>
</div>
<p>There were 32 studies without controls (first line in the table): 24/32 of these studies, or 75%, were markedly enthusiastic about the shunt, concluding that the benefits definitely outweighed the risks. In 15 studies there were controls, but assignment to treatment or control was not randomized. Only 10/15, or 67%, were markedly enthusiastic about the shunt. But the 4 studies that were randomized and controlled showed the surgery to be of little or no value. The badly designed studies exaggerated the value of this risky surgery.</p>
<p>A randomized, controlled experiment begins with a well-defined patient population. Some are eligible for the trial. Others are ineligible: they may be too sick to undergo the treatment, or they may have the wrong kind of disease, or they may not consent to participate. Eligibility is determined first; then the eligible patients are randomized to treatment or control. That way, the comparison is made only among patients who could have received the therapy. The bottom line: the control group is like the treatment group. By contrast, with poorly-controlled studies, ineligible patients may be used as controls. Moreover, even if controls are selected among those eligible for surgery, the surgeon may choose to operate only on the healthier patients while sicker patients are put in the control group.</p>
<p>This sort of bias seems to have been at work in the poorly-controlled studies of the portacaval shunt. In both the well-controlled and the poorly-controlled studies, about 60% of the surgery patients were still alive 3 years after the operation. In the randomized controlled experiments, the percentage of controls who survived the experiment by 3 years was also about 60%. But only 45% of the controls in the non-randomized experiments survived for 3 years.</p>
<div class="cell">
<div class="cell-output-display">
<table class="caption-top table table-sm table-striped small">
<caption>% patients alive after 3 years per (design, assignment)</caption>
<thead>
<tr class="header">
<th style="text-align: left;">design</th>
<th style="text-align: right;">surgery</th>
<th style="text-align: right;">control</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">randomized</td>
<td style="text-align: right;">60</td>
<td style="text-align: right;">60</td>
</tr>
<tr class="even">
<td style="text-align: left;">non_randomized</td>
<td style="text-align: right;">60</td>
<td style="text-align: right;">45</td>
</tr>
</tbody>
</table>
</div>
</div>
<p>In both types of studies, the surgeons seem to have used similar criteria to select patients eligible for surgery. Indeed, the survival rates for the surgery group are about the same in both kinds of studies. So, what was the crucial difference? With the randomized controlled experiments, the controls were similar in general health to the surgery patients. With the poorly controlled studies, there was a tendency to exclude sicker patients from the surgery group and use them as controls. That explains the bias in favor of surgery.</p>
</section>
<section id="repeated-weighing-of-nb10" class="level3">
<h3 class="anchored" data-anchor-id="repeated-weighing-of-nb10">Repeated Weighing of NB10</h3>
<p>In an ideal world, the same thing measured repeatedly would yield the same result. In practice, each result is thrown off by chance error that changes from measurement to measurement. One of the earliest scientists to deal with this problem was Tycho Brahe´ (1546–1601), the Danish astronomer. But it was probably noticed first in the market place, as merchants weighed out spices and measured off lengths of silk. There are several questions about chance errors. Where do they come from? How much is likely to cancel out in the average? The first question has a short answer: in most cases, nobody knows. We’ll address the second question via an example of precision weighing done at the National Bureau of Standards (NBS), now the National Institute of Science and Technology (NIST).</p>
<p>First, a brief explanation of standard weights. Stores weigh merchandise on scales. The scales are checked periodically by local weights-and-measures officials, using local standard weights. The local standards too must be periodically checked against external standards, and so on. Eventually weights are calibrated against national standards. In the US that is done by NBS, now NIST.</p>
<p>This chain of comparisons ends at the International Prototype Kilogram (for short, The Kilogram), a platinum-iridium weight held at the International Bureau of Weights and Measures near Paris. By international treaty (The Treaty of the Meter, 1875) “one kilogram” was defined to be the weight of this object under standard conditions. All other weights are determined relative to The Kilogram. For instance, The Pound = 0.4539237 of The Kilogram.</p>
<p>Each country that signed the Treaty of the Meter got a national prototype kilogram, whose exact weight had been determined as accurately as possible relative to The Kilogram. These prototypes were distributed by lot, and the United States got Kilogram #20. The values of all the U.S. national standards are determined relative to K20</p>
<p>In the US, accuracy in weighing at the supermarket ultimately depends on the accuracy of the calibration work by NBS/NIST. One basic issue is reproducibility: if a measurement is repeated, how much will it change? We will discuss the results for one such weight, called NB 10, whose nominal value is 10 grams (about the weight of two nickels). In fact, the people who manufactured NB 10 tried to make it weigh 10 grams and missed by a little. NB 10 was acquired by NBS around 1940, and they’ve weighed it many times since then. We’ll look at 100 of these measurements, which were made in the same room, on the same apparatus, by the same technicians. Every effort was made to follow the same procedure each time. All the factors known to affect the results, like air pressure or temperature, were kept as constant as possible.</p>
<p>Here are the first 5 measurements of NB10 in grams, along with the deficit (shortfall) from 10 grams expressed in micrograms.</p>
<div class="cell">
<div class="cell-output-display">
<table class="caption-top table table-sm table-striped small">
<caption>NB10: measurement (grams) and deficit (micrograms)</caption>
<thead>
<tr class="header">
<th style="text-align: right;">measurement</th>
<th style="text-align: right;">deficit</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: right;">9.999591</td>
<td style="text-align: right;">409</td>
</tr>
<tr class="even">
<td style="text-align: right;">9.999600</td>
<td style="text-align: right;">400</td>
</tr>
<tr class="odd">
<td style="text-align: right;">9.999594</td>
<td style="text-align: right;">406</td>
</tr>
<tr class="even">
<td style="text-align: right;">9.999601</td>
<td style="text-align: right;">399</td>
</tr>
<tr class="odd">
<td style="text-align: right;">9.999598</td>
<td style="text-align: right;">402</td>
</tr>
</tbody>
</table>
</div>
</div>
<p>Here are all 100 measurements expressed as deficits in micrograms.</p>
<div class="cell">
<div class="cell-output-display">
<table class="caption-top table table-sm table-striped small">
<caption>NB10 (index, deficit)</caption>
<thead>
<tr class="header">
<th style="text-align: right;">index</th>
<th style="text-align: right;">deficit</th>
<th style="text-align: right;">index</th>
<th style="text-align: right;">deficit</th>
<th style="text-align: right;">index</th>
<th style="text-align: right;">deficit</th>
<th style="text-align: right;">index</th>
<th style="text-align: right;">deficit</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: right;">1</td>
<td style="text-align: right;">409</td>
<td style="text-align: right;">26</td>
<td style="text-align: right;">397</td>
<td style="text-align: right;">51</td>
<td style="text-align: right;">404</td>
<td style="text-align: right;">76</td>
<td style="text-align: right;">404</td>
</tr>
<tr class="even">
<td style="text-align: right;">2</td>
<td style="text-align: right;">400</td>
<td style="text-align: right;">27</td>
<td style="text-align: right;">407</td>
<td style="text-align: right;">52</td>
<td style="text-align: right;">406</td>
<td style="text-align: right;">77</td>
<td style="text-align: right;">401</td>
</tr>
<tr class="odd">
<td style="text-align: right;">3</td>
<td style="text-align: right;">406</td>
<td style="text-align: right;">28</td>
<td style="text-align: right;">401</td>
<td style="text-align: right;">53</td>
<td style="text-align: right;">407</td>
<td style="text-align: right;">78</td>
<td style="text-align: right;">404</td>
</tr>
<tr class="even">
<td style="text-align: right;">4</td>
<td style="text-align: right;">399</td>
<td style="text-align: right;">29</td>
<td style="text-align: right;">399</td>
<td style="text-align: right;">54</td>
<td style="text-align: right;">405</td>
<td style="text-align: right;">79</td>
<td style="text-align: right;">408</td>
</tr>
<tr class="odd">
<td style="text-align: right;">5</td>
<td style="text-align: right;">402</td>
<td style="text-align: right;">30</td>
<td style="text-align: right;">401</td>
<td style="text-align: right;">55</td>
<td style="text-align: right;">411</td>
<td style="text-align: right;">80</td>
<td style="text-align: right;">406</td>
</tr>
<tr class="even">
<td style="text-align: right;">6</td>
<td style="text-align: right;">406</td>
<td style="text-align: right;">31</td>
<td style="text-align: right;">403</td>
<td style="text-align: right;">56</td>
<td style="text-align: right;">410</td>
<td style="text-align: right;">81</td>
<td style="text-align: right;">408</td>
</tr>
<tr class="odd">
<td style="text-align: right;">7</td>
<td style="text-align: right;">401</td>
<td style="text-align: right;">32</td>
<td style="text-align: right;">400</td>
<td style="text-align: right;">57</td>
<td style="text-align: right;">410</td>
<td style="text-align: right;">82</td>
<td style="text-align: right;">406</td>
</tr>
<tr class="even">
<td style="text-align: right;">8</td>
<td style="text-align: right;">403</td>
<td style="text-align: right;">33</td>
<td style="text-align: right;">410</td>
<td style="text-align: right;">58</td>
<td style="text-align: right;">410</td>
<td style="text-align: right;">83</td>
<td style="text-align: right;">401</td>
</tr>
<tr class="odd">
<td style="text-align: right;">9</td>
<td style="text-align: right;">401</td>
<td style="text-align: right;">34</td>
<td style="text-align: right;">401</td>
<td style="text-align: right;">59</td>
<td style="text-align: right;">401</td>
<td style="text-align: right;">84</td>
<td style="text-align: right;">412</td>
</tr>
<tr class="even">
<td style="text-align: right;">10</td>
<td style="text-align: right;">403</td>
<td style="text-align: right;">35</td>
<td style="text-align: right;">407</td>
<td style="text-align: right;">60</td>
<td style="text-align: right;">402</td>
<td style="text-align: right;">85</td>
<td style="text-align: right;">393</td>
</tr>
<tr class="odd">
<td style="text-align: right;">11</td>
<td style="text-align: right;">398</td>
<td style="text-align: right;">36</td>
<td style="text-align: right;">423</td>
<td style="text-align: right;">61</td>
<td style="text-align: right;">404</td>
<td style="text-align: right;">86</td>
<td style="text-align: right;">437</td>
</tr>
<tr class="even">
<td style="text-align: right;">12</td>
<td style="text-align: right;">403</td>
<td style="text-align: right;">37</td>
<td style="text-align: right;">406</td>
<td style="text-align: right;">62</td>
<td style="text-align: right;">405</td>
<td style="text-align: right;">87</td>
<td style="text-align: right;">418</td>
</tr>
<tr class="odd">
<td style="text-align: right;">13</td>
<td style="text-align: right;">407</td>
<td style="text-align: right;">38</td>
<td style="text-align: right;">406</td>
<td style="text-align: right;">63</td>
<td style="text-align: right;">392</td>
<td style="text-align: right;">88</td>
<td style="text-align: right;">415</td>
</tr>
<tr class="even">
<td style="text-align: right;">14</td>
<td style="text-align: right;">402</td>
<td style="text-align: right;">39</td>
<td style="text-align: right;">402</td>
<td style="text-align: right;">64</td>
<td style="text-align: right;">407</td>
<td style="text-align: right;">89</td>
<td style="text-align: right;">404</td>
</tr>
<tr class="odd">
<td style="text-align: right;">15</td>
<td style="text-align: right;">401</td>
<td style="text-align: right;">40</td>
<td style="text-align: right;">405</td>
<td style="text-align: right;">65</td>
<td style="text-align: right;">406</td>
<td style="text-align: right;">90</td>
<td style="text-align: right;">401</td>
</tr>
<tr class="even">
<td style="text-align: right;">16</td>
<td style="text-align: right;">399</td>
<td style="text-align: right;">41</td>
<td style="text-align: right;">405</td>
<td style="text-align: right;">66</td>
<td style="text-align: right;">404</td>
<td style="text-align: right;">91</td>
<td style="text-align: right;">401</td>
</tr>
<tr class="odd">
<td style="text-align: right;">17</td>
<td style="text-align: right;">400</td>
<td style="text-align: right;">42</td>
<td style="text-align: right;">409</td>
<td style="text-align: right;">67</td>
<td style="text-align: right;">403</td>
<td style="text-align: right;">92</td>
<td style="text-align: right;">407</td>
</tr>
<tr class="even">
<td style="text-align: right;">18</td>
<td style="text-align: right;">401</td>
<td style="text-align: right;">43</td>
<td style="text-align: right;">399</td>
<td style="text-align: right;">68</td>
<td style="text-align: right;">408</td>
<td style="text-align: right;">93</td>
<td style="text-align: right;">412</td>
</tr>
<tr class="odd">
<td style="text-align: right;">19</td>
<td style="text-align: right;">405</td>
<td style="text-align: right;">44</td>
<td style="text-align: right;">402</td>
<td style="text-align: right;">69</td>
<td style="text-align: right;">404</td>
<td style="text-align: right;">94</td>
<td style="text-align: right;">375</td>
</tr>
<tr class="even">
<td style="text-align: right;">20</td>
<td style="text-align: right;">402</td>
<td style="text-align: right;">45</td>
<td style="text-align: right;">407</td>
<td style="text-align: right;">70</td>
<td style="text-align: right;">407</td>
<td style="text-align: right;">95</td>
<td style="text-align: right;">409</td>
</tr>
<tr class="odd">
<td style="text-align: right;">21</td>
<td style="text-align: right;">408</td>
<td style="text-align: right;">46</td>
<td style="text-align: right;">406</td>
<td style="text-align: right;">71</td>
<td style="text-align: right;">412</td>
<td style="text-align: right;">96</td>
<td style="text-align: right;">406</td>
</tr>
<tr class="even">
<td style="text-align: right;">22</td>
<td style="text-align: right;">399</td>
<td style="text-align: right;">47</td>
<td style="text-align: right;">413</td>
<td style="text-align: right;">72</td>
<td style="text-align: right;">406</td>
<td style="text-align: right;">97</td>
<td style="text-align: right;">398</td>
</tr>
<tr class="odd">
<td style="text-align: right;">23</td>
<td style="text-align: right;">399</td>
<td style="text-align: right;">48</td>
<td style="text-align: right;">409</td>
<td style="text-align: right;">73</td>
<td style="text-align: right;">409</td>
<td style="text-align: right;">98</td>
<td style="text-align: right;">406</td>
</tr>
<tr class="even">
<td style="text-align: right;">24</td>
<td style="text-align: right;">402</td>
<td style="text-align: right;">49</td>
<td style="text-align: right;">404</td>
<td style="text-align: right;">74</td>
<td style="text-align: right;">400</td>
<td style="text-align: right;">99</td>
<td style="text-align: right;">403</td>
</tr>
<tr class="odd">
<td style="text-align: right;">25</td>
<td style="text-align: right;">399</td>
<td style="text-align: right;">50</td>
<td style="text-align: right;">402</td>
<td style="text-align: right;">75</td>
<td style="text-align: right;">408</td>
<td style="text-align: right;">100</td>
<td style="text-align: right;">404</td>
</tr>
</tbody>
</table>
</div>
</div>
<p>Here is the distribution of the NB10 deficits expressed as a histogram.</p>
<div class="cell">
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="s_3a_4350_files/figure-html/g_NB10-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p>The average deficit is 405 micrograms, and the standard deviation is about 6.5 micrograms.</p>
<p>The next figure shows the deficits expressed in standard units. The histogram has been smoothed into an approximate density function, with a standard normal curve superimposed.</p>
<div class="cell">
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="s_3a_4350_files/figure-html/g_NB10_z_score-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p>The first of the two figures above shows that the average deficit of NB10 is around 405 micrograms. Thus the actual weight of NB10 is likely to be about 10 grams minus 405 micrograms. Knowing this, one could calibrate other weights against NB10, adjusting for the fact that NB10 weighs this much less than the nominal 10 grams. Without such knowledge, taking NB10 at face value as weighing 10 grams would amount to a <em>biased</em> measurement system.</p>
<p>The second of the two figures above reveals measurements whose standard units (z-scores) are near <span class="math inline">\(\pm 5\)</span>. (The indices of the outlying measurements are #86 and #94.) NBS could find no reason to disqualify these values. Now, a sample of size 100 from a normal distribution would be highly unlikely to include such large deviations from the average value. We conclude that this very carefully controlled measurement process produces values that do not follow the normal distribution.</p>
<p>Key points:</p>
<ul>
<li>High-precision measurement systems typically reveal chance errors in the measurement process. Before relying on such systems one should determine the likely size of such chance errors by generating repeated measurements and calculating their standard deviation (or some other measure of the spread in values).</li>
<li>A small proportion of outlying values are possible even from the most careful measurement process. These outliers strongly influence the calculated mean and standard deviation of the data.</li>
<li>One should consider the possibility that a measurement system is biased. In this case, each measurement can be represented as the sum of three terms: the actual (unknown) value + bias + chance error.</li>
</ul>
</section>
</section>
<section id="accuracy-of-the-sample-average" class="level2">
<h2 class="anchored" data-anchor-id="accuracy-of-the-sample-average">Accuracy of the Sample Average</h2>
<p>The last example showed that NB10, nominally weighing 10 grams, actually weighs a bit less, namely, about 405 micrograms less than 10 grams. Of course a new batch of measurements of NB10 might yield an average deficit differing a bit from 405 micrograms. Just how different might that new average be? Here is a quick review of the mathematical answer to that question.</p>
<p>We model a sequence of measured deficits</p>
<p><span class="math display">\[
\begin{align}
  D_{\bullet} &amp;= (D_1, \ldots, D_n)
\end{align}
\]</span></p>
<p>as independent, identically distributed random variables (whose common distribution is something like the histogram shown above). Each measured deficit <span class="math inline">\(D_j\)</span> is represented as the sum of <span class="math inline">\(\mu_d\)</span>, the actual (but unknown) deficit, plus <span class="math inline">\(\epsilon_j\)</span>, a chance error.</p>
<p><span class="math display">\[
\begin{align}
  D_j &amp;= \mu_D + \epsilon_j
\end{align}
\]</span></p>
<p>We assume the population distribution of the chance errors has the same shape and scale as that of measured deficits, but with a population mean value of zero. Thus the chance errors have the same population standard deviation, <span class="math inline">\(\sigma_D\)</span>, as the measured deficits. Based on the 100 NB10 measurements this unknown value is not too far from 6.5 micrograms.</p>
<p>Then <span class="math inline">\(S(D_{\bullet})\)</span>, the sum of <span class="math inline">\(n\)</span> measured deficits, has the following expected value (population mean) and population variance.</p>
<p><span class="math display">\[
\begin{align}
  S(D_{\bullet}) &amp;= \sum_{j = 1}^n D_j \\
  &amp;= \sum_{j = 1}^n ( \mu_D + \epsilon_j ) \\
  &amp;= n \; \mu_D \; + \; \sum_{j = 1}^n \epsilon_j \\
  \\
  E \left\{ S(D_{\bullet}) \right\} &amp;= n \; \mu_D \\
  \\
  Var \left\{ S(D_{\bullet}) \right\} &amp;= n \; Var \left\{ \epsilon_j \right\} \\
  &amp;= n \; \sigma_D^2 \\
\end{align}
\]</span></p>
<p>Denoting the sample average as <span class="math inline">\(A(\cdot)\)</span>, we have</p>
<p><span class="math display">\[
\begin{align}
  A(D_{\bullet}) &amp;= \frac{1}{n} S(D_{\bullet}) \\
  &amp;= \mu_D \; + \; A(\epsilon_{\bullet}) \\
  \\
  E \left\{ A(D_{\bullet}) \right\} &amp;= \mu_D \\
  \\
  Var \left\{ A(D_{\bullet}) \right\} &amp;= \frac{1}{n^2} Var \left\{ S(D_{\bullet}) \right\} \\
  &amp;= \frac{1}{n^2}  \; n \; \sigma_D^2 \\
  &amp;= \frac{1}{n}  \; \sigma_D^2 \\
  \\
  SD \left\{ A(D_{\bullet}) \right\} &amp;= \sqrt(Var \left\{ A(D_{\bullet}) \right\}) \\
  &amp;= \frac{1}{\sqrt{n}}  \; \sigma_D \\
\end{align}
\]</span></p>
<p>Thus the population standard deviation of the sample average <span class="math inline">\(A(D_{\bullet})\)</span> can be estimated from the sample standard deviation:</p>
<p><span class="math display">\[
\begin{align}
  \hat{SD} \left\{ A(D_{\bullet}) \right\} &amp;= \frac{1}{\sqrt{n}}  \; \hat{\sigma}_D \\
\end{align}
\]</span></p>
<p>Returning to our sample of 100 NB10 measurements, with a sample average of about 405 micrograms and a sample standard deviation of about 6.5 micrograms, we have</p>
<p><span class="math display">\[
\begin{align}
  \hat{SD} \left\{ A(D_{\bullet}) \right\} &amp;= \frac{1}{\sqrt{100}}  \; 6.5 \\
  &amp;= 0.65
\end{align}
\]</span></p>
<p>Our sample average of 405 micrograms probably deviates from the actual deficit of NB10 by no more 2 micrograms or so.</p>
</section>
<section id="team-exercises" class="level2">
<h2 class="anchored" data-anchor-id="team-exercises">Team Exercises</h2>
<ol type="1">
<li><p>A teaching assistant gives a quiz to his section. There are 10 questions on the quiz and no part credit is given. After grading the papers, the TA writes down for each student the number of questions the student got right and the number wrong. The average number of right answers is 6.4 with an SD of 2.0. The average number of wrong answers is [?] with an SD of [?]. Fill in the blanks, or do you need the data? Explain briefly.</p></li>
<li><p>A large, representative sample of Americans was studied by the Public Health Service, in the Health and Nutrition Examination Survey (HANES2). The percentage of respondents who were left-handed decreased steadily with age, from 10% at 20 years to 4% at 70. “The data show that many people change from left-handed to right-handed as they get older.” True or false? Why? If false, how do you explain the pattern in the data?</p></li>
<li><p>For a certain group of women, the 25th percentile of height is 62.2 inches and the 75th percentile is 65.8 inches. The histogram follows the normal curve. Find the 90th percentile of the height distribution.</p></li>
</ol>
</section>
<section id="resources" class="level2">
<h2 class="anchored" data-anchor-id="resources">Resources</h2>
<p>“Statistics, 4/e” by Freedman, Pisani, and Purves ([FPP](https://www.goodreads.com/book/show/147358.Statistics))</p>
<p>[Sampling Techniques, 3/e](https://www.google.co.uk/books/edition/Sampling_Techniques/8Y4QAQAAIAAJ?hl=en) by William G. Cochran</p>
</section>


<div id="quarto-appendix" class="default"><section id="footnotes" class="footnotes footnotes-end-of-document" role="doc-endnotes"><h2 class="anchored quarto-appendix-heading">Footnotes</h2>

<ol>
<li id="fn1"><p>Gallup and others used quota sampling in pre-election surveys from 1936 though 1948. Interviewers consistently chose a disproportionate number of people who wound up voting Republican, but until 1948, a close election, the Democratic lead was larger than this oversampling of Republicans.<a href="#fnref1" class="footnote-back" role="doc-backlink">↩︎</a></p></li>
<li id="fn2"><p>On the other hand, if a percentage or average is known to vary across identifiable subsets (strata) of the population, then <em>stratified sampling</em> can yield more accurate estimates than simple random sampling.<a href="#fnref2" class="footnote-back" role="doc-backlink">↩︎</a></p></li>
<li id="fn3"><p>Each interviewer is given a prescribed protocol for selecting a an eligible voter within the household (e.g., oldest eligible female, if present, or else youngest eligible male), with these prescriptions possibly varying among interviewers.<a href="#fnref3" class="footnote-back" role="doc-backlink">↩︎</a></p></li>
</ol>
</section></div></main>
<!-- /main column -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const onCopySuccess = function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  }
  const getTextToCopy = function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button:not([data-in-quarto-modal])', {
    text: getTextToCopy
  });
  clipboard.on('success', onCopySuccess);
  if (window.document.getElementById('quarto-embedded-source-code-modal')) {
    // For code content inside modals, clipBoardJS needs to be initialized with a container option
    // TODO: Check when it could be a function (https://github.com/zenorocha/clipboard.js/issues/860)
    const clipboardModal = new window.ClipboardJS('.code-copy-button[data-in-quarto-modal]', {
      text: getTextToCopy,
      container: window.document.getElementById('quarto-embedded-source-code-modal')
    });
    clipboardModal.on('success', onCopySuccess);
  }
    var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
    var mailtoRegex = new RegExp(/^mailto:/);
      var filterRegex = new RegExp('/' + window.location.host + '/');
    var isInternal = (href) => {
        return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
    }
    // Inspect non-navigation links and adorn them if external
 	var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
    for (var i=0; i<links.length; i++) {
      const link = links[i];
      if (!isInternal(link.href)) {
        // undo the damage that might have been done by quarto-nav.js in the case of
        // links that we want to consider external
        if (link.dataset.originalHref !== undefined) {
          link.href = link.dataset.originalHref;
        }
      }
    }
  function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
    const config = {
      allowHTML: true,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start',
    };
    if (contentFn) {
      config.content = contentFn;
    }
    if (onTriggerFn) {
      config.onTrigger = onTriggerFn;
    }
    if (onUntriggerFn) {
      config.onUntrigger = onUntriggerFn;
    }
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      if (note) {
        return note.innerHTML;
      } else {
        return "";
      }
    });
  }
  const xrefs = window.document.querySelectorAll('a.quarto-xref');
  const processXRef = (id, note) => {
    // Strip column container classes
    const stripColumnClz = (el) => {
      el.classList.remove("page-full", "page-columns");
      if (el.children) {
        for (const child of el.children) {
          stripColumnClz(child);
        }
      }
    }
    stripColumnClz(note)
    if (id === null || id.startsWith('sec-')) {
      // Special case sections, only their first couple elements
      const container = document.createElement("div");
      if (note.children && note.children.length > 2) {
        container.appendChild(note.children[0].cloneNode(true));
        for (let i = 1; i < note.children.length; i++) {
          const child = note.children[i];
          if (child.tagName === "P" && child.innerText === "") {
            continue;
          } else {
            container.appendChild(child.cloneNode(true));
            break;
          }
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(container);
        }
        return container.innerHTML
      } else {
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        return note.innerHTML;
      }
    } else {
      // Remove any anchor links if they are present
      const anchorLink = note.querySelector('a.anchorjs-link');
      if (anchorLink) {
        anchorLink.remove();
      }
      if (window.Quarto?.typesetMath) {
        window.Quarto.typesetMath(note);
      }
      // TODO in 1.5, we should make sure this works without a callout special case
      if (note.classList.contains("callout")) {
        return note.outerHTML;
      } else {
        return note.innerHTML;
      }
    }
  }
  for (var i=0; i<xrefs.length; i++) {
    const xref = xrefs[i];
    tippyHover(xref, undefined, function(instance) {
      instance.disable();
      let url = xref.getAttribute('href');
      let hash = undefined; 
      if (url.startsWith('#')) {
        hash = url;
      } else {
        try { hash = new URL(url).hash; } catch {}
      }
      if (hash) {
        const id = hash.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note !== null) {
          try {
            const html = processXRef(id, note.cloneNode(true));
            instance.setContent(html);
          } finally {
            instance.enable();
            instance.show();
          }
        } else {
          // See if we can fetch this
          fetch(url.split('#')[0])
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.getElementById(id);
            if (note !== null) {
              const html = processXRef(id, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      } else {
        // See if we can fetch a full url (with no hash to target)
        // This is a special case and we should probably do some content thinning / targeting
        fetch(url)
        .then(res => res.text())
        .then(html => {
          const parser = new DOMParser();
          const htmlDoc = parser.parseFromString(html, "text/html");
          const note = htmlDoc.querySelector('main.content');
          if (note !== null) {
            // This should only happen for chapter cross references
            // (since there is no id in the URL)
            // remove the first header
            if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
              note.children[0].remove();
            }
            const html = processXRef(null, note);
            instance.setContent(html);
          } 
        }).finally(() => {
          instance.enable();
          instance.show();
        });
      }
    }, function(instance) {
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            div.style.left = 0;
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
        // Handle positioning of the toggle
    window.addEventListener(
      "resize",
      throttle(() => {
        elRect = undefined;
        if (selectedAnnoteEl) {
          selectCodeLines(selectedAnnoteEl);
        }
      }, 10)
    );
    function throttle(fn, ms) {
    let throttle = false;
    let timer;
      return (...args) => {
        if(!throttle) { // first call gets through
            fn.apply(this, args);
            throttle = true;
        } else { // all the others get throttled
            if(timer) clearTimeout(timer); // cancel #2
            timer = setTimeout(() => {
              fn.apply(this, args);
              timer = throttle = false;
            }, ms);
        }
      };
    }
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
</div> <!-- /content -->




</body></html>