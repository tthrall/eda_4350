gt_lo_ma5 <- gt_lo |>
stats::filter(filter = rep(1/5, 5))
names(gt_lo_ma5) <- c("land", "ocean")
#| label: gt_lo_ma5__tsplot
astsa::tsplot(
gt_lo_ma5,
ncolm = 2,
spaghetti=TRUE,
col=astsa.col(c(4,2),.7),
pch=c(20,18),
type="o",
ylab="\u00B0C",
main="Temperature Deviations (5-year avg)",
addLegend=TRUE,
location="topleft",
legend=c("Land Surface","Sea Surface")
)
#| label: cardox_records
par(mfrow=2:1)
tsplot(
cardox, col = 4, ylab = bquote(CO[2]),
main="Monthly Carbon Dioxide Readings - Mauna Loa Observatory"
)
tsplot(
diff(diff(cardox, 12)), col = 4,
ylab = "diff(CO2, 2)"
)
#| label: cardox_forecast
cardox_forecast <-
sarima.for(
cardox, 60, 1,1,1, 0,1,1,12,
col=4, ylab = bquote(CO[2])
)
abline(v=2023.17, lty=6)
#| label: s5a_books_tbl
s5a_books_tbl <- tibble::tibble(
title = c(
"Time Series (2e)",
"Time Series Analysis and Its Applications: With R Examples (5e)"
),
link = c(
"https://doi.org/10.1137/1.9780898719246",
"https://doi.org/10.1007/978-3-031-70584-7"
),
auth = c(
"David Brillinger",
"Robert Shumway and David Stoffer"
)
) |>
dplyr::arrange(title)
#| label: s5a_books_tbl__save
# save file only when updated
save_to_file <- FALSE
if (save_to_file) {
# TSV format
s5a_books_tbl |> readr::write_tsv(here::here(
"markdown", "s5a_ts_intro", "s5a_books_tbl.txt"
))
}
#| label: s5a_articles_tbl
s5a_articles_tbl <- tibble::tribble(
~title, ~link,
"Bartlett's test - Wikipedia",
"https://en.wikipedia.org/wiki/Bartlett%27s_test",
"CRAN Task View: Time Series Analysis",
"https://cran.r-project.org/web/views/TimeSeries.html",
"Fun with asta",
"https://github.com/nickpoison/astsa/tree/master/fun_with_astsa",
"hwwntest: Tests of White Noise using Wavelets",
"https://cran.r-project.org/web/packages/hwwntest/index.html",
"Ljung–Box test - Wikipedia",
"https://en.wikipedia.org/wiki/Ljung%E2%80%93Box_test",
"R Tutorial | Stoffer’s GitHome",
"https://dsstoffer.github.io/Rtoot.html#regression-and-time-series-primer",
"Some remarks on the analysis of time-series (Bartlett, 1967)",
"https://doi.org/10.1093/biomet/54.1-2.25"
) |>
dplyr::arrange(title)
#| label: s5a_articles_tbl__save
# save file only when updated
save_to_file <- FALSE
if (save_to_file) {
# TSV format
s5a_articles_tbl |> readr::write_tsv(here::here(
"markdown", "s5a_ts_intro", "s5a_articles_tbl.txt"
))
}
#| label: s5a_symbol_tbl
s5a_symbol_tbl <- tibble::tribble(
~tag, ~symbol, ~dscr,
"a_u",
"$a_{\\bullet, \\bullet} (u)$",
"matrix of filter coefficients at time-shift $u$",
"B",
"$\\mathcal{B}$",
"back-shift operator",
"D",
"$\\mathcal{D}$",
"difference operator, $\\mathcal{I} - \\mathcal{B}$",
"ACovF",
"$\\gamma_{\\bullet, \\bullet} (u)$",
"auto-covariance matrix at time-shift $u$",
"I",
"$\\mathcal{I}$",
"identity operator",
"m_vec",
"$m_\\bullet (t)$",
"$E \\{ X_\\bullet (t) \\}$, expected value of $X_\\bullet (t)$",
"T",
"$T$",
"number of time series observations",
"mu_X",
"$\\mu_X$",
"the expected value of random variable $X (t_0)$",
"N_d",
"$N_d$",
"number of independent draws (effective sample size)",
"S_X_T",
"$S_{X, T}$",
"the sample sum of T observations of $X (t)$",
"sig2_X",
"$\\sigma_X^2$",
"the variance of random variable $X (t_0)$",
"t_0",
"$t_0$",
"initial time index of a time series data set",
"X_vec",
"$X_\\bullet (t)$",
"$(X_1 (t), \\ldots, X_d (t))$, a multivariate random process"
)
#| label: s5a_symbol_tbl__save
# save file only when updated
save_to_file <- FALSE
if (save_to_file) {
# RDS format
s5a_symbol_tbl |> readr::write_rds(here::here(
"data", "retain", "s5a_symbol_tbl.rds"
))
# TSV format
s5a_symbol_tbl |> readr::write_tsv(here::here(
"data", "retain", "s5a_symbol_tbl.txt"
))
}
#| label: s5a_symbol_tbl__kable
s5a_symbol_tbl |>
dplyr::select(symbol, dscr) |>
knitr::kable(
format = "html",
escape = FALSE,
caption = "Glossary of Mathematical Symbols (s)",
col.names = c("s", "description")
)
s5a_symbol_tbl |> readr::write_tsv(here::here(
"markdown", "s5a_ts_intro", "s5a_symbol_tbl.txt"
))
#| label: setup
#| include: false
knitr::opts_chunk$set(
echo    = FALSE,
error   = FALSE,
message = FALSE,
warning = FALSE
)
#| label: cran_libraries
library(assertthat)
library(astsa)
library(here)
library(knitr)
library(latex2exp)
library(tidyverse)
library(tinytex)
library(tsibble)
library(tsibbledata)
library(xts)
#| label: local_libraries
# library(ugrid)
#| label: local_source
# gen_ds_tbl
# compile a tibble that identifies data sets
source(here("code", "gen_ds_tbl.R"))
# get_ref_materials
# encapsulate reference materials as separate modules
source(here("code", "get_ref_materials.R"))
#| label: plotting_params
# grid-points in (-m pi, m pi), m = m_periods
# x_vec <- u_vec * (m_periods * pi)
#| label: astsa_data_set_tbl
astsa_data_set_tbl <- get_all_ds_per_pkg(pkgs = "astsa")
# write to file only as needed
save_to_file <- FALSE
if (save_to_file) {
# TSV
astsa_data_set_tbl |>
readr::write_tsv(here(
"data", "retain", "astsa_data_set_tbl.txt"
))
# RDS
astsa_data_set_tbl |>
readr::write_rds(here(
"data", "rds", "astsa_data_set_tbl.rds"
))
}
#| label: g_sunspots
g_sunspots <- astsa::tsplot(
x = datasets::sunspot.month,
ylab = "sunspot count",
col = 4)
#| label: faithful_tbl
faithful_tbl <- datasets::faithful |>
tibble::as_tibble() |>
dplyr::rename(
duration = eruptions,
delay    = waiting
) |>
dplyr::select(delay, duration)
#| label: g_faithful_tbl
g_faithful_tbl <- faithful_tbl |>
ggplot(mapping = aes(
x = delay, y = duration
)) +
geom_point() +
labs(title = "Old Faithful eruptions: delay and duration")
g_faithful_tbl
#| label: climate_ds_tbl
# names of relevant data sets from package astsa::
climate_ds_names <- c(
"cardox", "ENSO", "gtemp.month", "gtemp_both",
"gtemp_land", "gtemp_ocean", "soi"
)
climate_ds_tbl <- select_ds_per_pkg(
pkgs = "astsa",
datasets = climate_ds_names)
#| label: climate_ds_tbl__kable
climate_ds_tbl |> knitr::kable(
caption = "Climate: selected data sets"
)
#| label: tmp_lob
# join surface temperatures into multivariate ts
tmp_lo <- cbind(
astsa::gtemp_land,
astsa::gtemp_ocean)
dimnames(tmp_lo) [[2]] <- c("land", "ocean")
tmp_lob <-
cbind(tmp_lo, astsa::gtemp_both)
dimnames(tmp_lob) [[2]] <- c("land", "ocean", "both")
#| label: ref_lob_tbl
# tmp_lob subset: 1991-2020 reference period
ref_lob_tbl <- tmp_lob |>
tibble::as_tibble() |>
dplyr::mutate(yr = 1850:2023) |>
dplyr::select(yr, land, ocean, both) |>
dplyr::filter(yr >= 1991, yr <= 2020)
#| label: ref_lob_smy
# check average deviation for reference period 1991-2020
land_smy_vec  <- ref_lob_tbl$ land  |> summary()
ocean_smy_vec <- ref_lob_tbl$ ocean |> summary()
both_smy_vec  <- ref_lob_tbl$ both  |> summary()
ref_lob_smy <- tibble::tibble(
stat  = c("min", "q_1", "mid", "avg", "q_3", "max"),
land  = land_smy_vec,
ocean = ocean_smy_vec,
both  = both_smy_vec
)
# ref_lob_smy
# # A tibble: 6 × 4
#   stat  land     ocean     both
#   <chr> <table>  <table>   <table>
# 1 min   0.360000 0.2600000 0.3000000
# 2 q_1   0.815000 0.3700000 0.5175000
# 3 mid   1.120000 0.4350000 0.6750000
# 4 avg   1.193667 0.4776667 0.6993333
# 5 q_3   1.570000 0.5525000 0.8425000
# 6 max   2.500000 0.8300000 1.3500000
#| label: gtemp__plot
g_temp_lo <- astsa::tsplot(
cbind(gtemp_land, gtemp_ocean),
spaghetti=TRUE,
col=astsa.col(c(4,2),.7),
pch=c(20,18),
type="o",
ylab="\u00B0C",
main="Global Surface Temperature Deviations",
addLegend=TRUE,
location="topleft",
legend=c("Land Surface","Sea Surface")
)
#| label: soi__plot
par(mfrow=2:1)
g_soi <- astsa::tsplot(soi, ylab="", main="Southern Oscillation Index", col=4)
text(1970, .91, "COOL", col=5, font=4)
text(1970, -.91, "WARM", col=6, font=4)
g_rec <- astsa::tsplot(rec, ylab="", main="Recruitment", col=4)
#| label: pred_prey__plot
g_hare_lynx <- tsplot(
cbind(Hare, Lynx),
col=c(2,4),
type="o",
pch=c(0,2),
ylab="Number",
spaghetti=TRUE,
addLegend=TRUE)
mtext("(\u00D7 1000)", side=2, adj=1, line=1.5, cex=.8)
#| label: jj__plot
par(mfrow=2:1)
g_jj <- astsa::tsplot(
jj,
col=4,
ylab="USD",
type="o",
main="Johnson & Johnson Quarterly Earnings per Share")
g_jj_log <- astsa::tsplot(
jj, col=4, ylab="USD", type="o", log="y")
#| label: djia__plot
# log-ratio of successive closing values
djia_return <-
astsa::djia $Close |> log() |> diff()
par(mfrow=2:1)
plot(djia$Close, col=4, main="DJIA Close")
plot(djia_return, col=4, main="DJIA Returns")
#| label: fmri__plot
par(mfrow=c(3,1))
# fMRI response data
x = ts(fmri1[,4:9], start=0, freq=32)
# square-wave stimulus
u = ts(
rep(c(rep(.6,16), rep(-.6,16)), 4),
start=0,
freq=32)
# area of the brain
# fMRI recorded in two locations per area
names = c(
"Cortex (2 locations)",
"Thalamus (2 locations)",
"Cerebellum (2 locations)"
)
g_fmri <- list()
for (i in 1:3){
j = 2*i-1
g_fmri [[i]] <- astsa::tsplot(
x[,j:(j+1)],
ylab="BOLD", xlab="",
main=names[i], col=5:6,
ylim=c(-.6,.6), lwd=2, xaxt="n", spaghetti=TRUE
)
axis(seq(0,256,64), side=1, at=0:4)
lines(u, type="s", col=gray(.3))
}
mtext("seconds", side=1, line=1.75, cex=.9)
#| label: speech__plot
g_speech <- astsa::tsplot(speech, col=4)
arrows(658, 3850, 766, 3850,
code=3, angle=90, length=.05, col=6)
text(712, 4100, "pitch period", cex=.75)
#| label: eqexp__plot
g_eqexp <- astsa::tsplot(
cbind(EQ5,EXP6),
ylab=c("Earthquake", "Explosion"),
col=4
)
#| label: hl_pelts
hl_pelts <- tsibbledata::pelt |>
dplyr::rename(yr = Year, hare = Hare, lynx = Lynx) |>
dplyr::mutate(across(
.cols = c(hare, lynx),
.fns  = ~ .x/1000
))
#| label: hl_pelts__print
hl_pelts |> as_tibble() |> print(n = 5)
#| label: gt_lo
gt_lo <- cbind(
astsa::gtemp_land, astsa::gtemp_ocean)
names(gt_lo) <- c("land", "ocean")
#| label: gt_lo_ma5
gt_lo_ma5 <- gt_lo |>
stats::filter(filter = rep(1/5, 5))
names(gt_lo_ma5) <- c("land", "ocean")
#| label: gt_lo_ma5__tsplot
astsa::tsplot(
gt_lo_ma5,
ncolm = 2,
spaghetti=TRUE,
col=astsa.col(c(4,2),.7),
pch=c(20,18),
type="o",
ylab="\u00B0C",
main="Temperature Deviations (5-year avg)",
addLegend=TRUE,
location="topleft",
legend=c("Land Surface","Sea Surface")
)
#| label: cardox_records
par(mfrow=2:1)
tsplot(
cardox, col = 4, ylab = bquote(CO[2]),
main="Monthly Carbon Dioxide Readings - Mauna Loa Observatory"
)
tsplot(
diff(diff(cardox, 12)), col = 4,
ylab = "diff(CO2, 2)"
)
#| label: cardox_forecast
cardox_forecast <-
sarima.for(
cardox, 60, 1,1,1, 0,1,1,12,
col=4, ylab = bquote(CO[2])
)
abline(v=2023.17, lty=6)
#| label: s5a_books_tbl
s5a_books_tbl <- tibble::tibble(
title = c(
"Time Series (2e)",
"Time Series Analysis and Its Applications: With R Examples (5e)"
),
link = c(
"https://doi.org/10.1137/1.9780898719246",
"https://doi.org/10.1007/978-3-031-70584-7"
),
auth = c(
"David Brillinger",
"Robert Shumway and David Stoffer"
)
) |>
dplyr::arrange(title)
#| label: s5a_books_tbl__save
# save file only when updated
save_to_file <- FALSE
if (save_to_file) {
# TSV format
s5a_books_tbl |> readr::write_tsv(here::here(
"markdown", "s5a_ts_intro", "s5a_books_tbl.txt"
))
}
#| label: s5a_articles_tbl
s5a_articles_tbl <- tibble::tribble(
~title, ~link,
"Bartlett's test - Wikipedia",
"https://en.wikipedia.org/wiki/Bartlett%27s_test",
"CRAN Task View: Time Series Analysis",
"https://cran.r-project.org/web/views/TimeSeries.html",
"Fun with asta",
"https://github.com/nickpoison/astsa/tree/master/fun_with_astsa",
"hwwntest: Tests of White Noise using Wavelets",
"https://cran.r-project.org/web/packages/hwwntest/index.html",
"Ljung–Box test - Wikipedia",
"https://en.wikipedia.org/wiki/Ljung%E2%80%93Box_test",
"R Tutorial | Stoffer’s GitHome",
"https://dsstoffer.github.io/Rtoot.html#regression-and-time-series-primer",
"Some remarks on the analysis of time-series (Bartlett, 1967)",
"https://doi.org/10.1093/biomet/54.1-2.25"
) |>
dplyr::arrange(title)
#| label: s5a_articles_tbl__save
# save file only when updated
save_to_file <- FALSE
if (save_to_file) {
# TSV format
s5a_articles_tbl |> readr::write_tsv(here::here(
"markdown", "s5a_ts_intro", "s5a_articles_tbl.txt"
))
}
#| label: s5a_symbol_tbl
s5a_symbol_tbl <- tibble::tribble(
~tag, ~symbol, ~dscr,
"a_u",
"$a_{\\bullet, \\bullet} (u)$",
"matrix of filter coefficients at time-shift $u$",
"B",
"$\\mathcal{B}$",
"back-shift operator",
"D",
"$\\mathcal{D}$",
"difference operator, $\\mathcal{I} - \\mathcal{B}$",
"ACovF",
"$\\gamma_{\\bullet, \\bullet} (u)$",
"auto-covariance matrix at time-shift $u$",
"I",
"$\\mathcal{I}$",
"identity operator",
"m_vec",
"$m_\\bullet (t)$",
"$E \\{ X_\\bullet (t) \\}$, expected value of $X_\\bullet (t)$",
"T",
"$T$",
"number of time series observations",
"mu_X",
"$\\mu_X$",
"the expected value of random variable $X (t_0)$",
"N_d",
"$N_d$",
"number of independent draws (effective sample size)",
"S_X_T",
"$S_{X, T}$",
"the sample sum of T observations of $X (t)$",
"sig2_X",
"$\\sigma_X^2$",
"the variance of random variable $X (t_0)$",
"t_0",
"$t_0$",
"initial time index of a time series data set",
"X_vec",
"$X_\\bullet (t)$",
"$(X_1 (t), \\ldots, X_d (t))$, a multivariate random process"
)
#| label: s5a_symbol_tbl__save
# save file only when updated
save_to_file <- FALSE
if (save_to_file) {
# TSV format
s5a_symbol_tbl |> readr::write_tsv(here::here(
"markdown", "s5a_ts_intro", "s5a_symbol_tbl.txt"
))
}
