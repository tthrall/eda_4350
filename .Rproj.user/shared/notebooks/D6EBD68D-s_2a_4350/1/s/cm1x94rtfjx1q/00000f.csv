"0","# compute z-score means and std-devs per group"
"0",""
"0","# number of observations per group as a data frame"
"0","coll_counts_per_grp <- college_z_scores |> "
"0","  summarise("
"0","    .by = grp_lbl, "
"0","    count = n()"
"0","  ) |> "
"0","  arrange(grp_lbl) |> "
"0","  column_to_rownames(""grp_lbl"")"
"0",""
"0","coll_z_means_per_grp <- college_z_scores |> "
"0","  summarise("
"0","    .by = grp_lbl, "
"0","    across("
"0","      .cols = everything(), "
"0","      .fns  = ~ mean(.x, na.rm = TRUE)"
"0","    )"
"0","  ) |> "
"0","  arrange(grp_lbl)"
"0",""
"0","coll_z_sds_per_grp <- college_z_scores |> "
"0","  summarise("
"0","    .by = grp_lbl, "
"0","    across("
"0","      .cols = everything(), "
"0","      .fns  = ~ sd(.x, na.rm = TRUE)"
"0","    )"
"0","  ) |> "
"0","  arrange(grp_lbl)"
"0",""
"0","# transpose coll_z_sds_per_grp"
"0","grp_z_sds_per_var <- coll_z_sds_per_grp |> "
"0","  column_to_rownames(""grp_lbl"") |> "
"0","  t() |> "
"0","  as_tibble(rownames = ""var"")"
"0",""
"0","grp_z_ss <- grp_z_sds_per_var |> "
"0","  # (RMSE per var) to (MSE per var)"
"0","  mutate(across("
"0","    .cols = - var, "
"0","    .fns  = ~ .x^2"
"0","  )) |> "
"0","  # (MSE per var) to (SSE per var)"
"0","  mutate("
"0","    g_00 = g_00 * (-1 + coll_counts_per_grp[[""g_00"", ""count""]]), "
"0","    g_01 = g_01 * (-1 + coll_counts_per_grp[[""g_01"", ""count""]]), "
"0","    g_10 = g_10 * (-1 + coll_counts_per_grp[[""g_10"", ""count""]]), "
"0","    g_11 = g_11 * (-1 + coll_counts_per_grp[[""g_11"", ""count""]])"
"0","  ) |> "
"0","  # sum (SSE per var) across vars"
"0","  summarise(across("
"0","    .cols = - var, "
"0","    .fns  = ~ sum(.x, na.rm = TRUE)"
"0","  )) |> "
"0","  # transpose to facilitate summing across groups"
"0","  pivot_longer("
"0","    cols = everything(), "
"0","    names_to = ""group"", "
"0","    values_to = ""SSE"""
"0","  ) |> "
"0","  # calculate (count, df, MSE, RMSE) per group"
"0","  mutate("
"0","    count = coll_counts_per_grp [, ""count""], "
"0","    df    = count - n_z_score_vars, "
"0","    MSE   = SSE / df, "
"0","    RMSE  = sqrt(MSE)"
"0","  ) |> "
"0","  dplyr::select("
"0","    group, count, df, RMSE, MSE, SSE"
"0","  )"
"0",""
"0","# within sum of squares (across groups)"
"0","grp_z_ss_all <- sum(grp_z_ss$SSE, na.rm = TRUE)"
